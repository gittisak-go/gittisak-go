<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>gittisak-go — SPA</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 2rem; }
    nav a { margin-right: 1rem; }
  </style>
</head>
<body>
  <h1>gittisak-go — Single Page</h1>
  <nav>
    <a href="/" data-link>Home</a>
    <a href="/about" data-link>About</a>
    <a href="/contact" data-link>Contact</a>
  </nav>

  <main id="view" style="margin-top:1rem"></main>

  <script>
    // If page was redirected from 404.html and original path encoded in hash
    (function(){
      try {
        if(location.hash && location.hash.startsWith('#')){
          const h = decodeURIComponent(location.hash.slice(1));
          // if hash encodes original pathname like /about, replace history
          if(h && h.startsWith('/')){
            history.replaceState(null, null, h);
          }
        }
      } catch(e){
        console.warn('Failed to restore path from hash:', e);
      }
    })();

    // Cache DOM reference to avoid repeated queries
    const viewElement = document.getElementById('view');
    
    // Create reusable 404 handler to avoid recreating it
    const notFoundHandler = () => viewElement.innerHTML = '<p>ไม่พบหน้า</p>';

    const routes = {
      '/': () => viewElement.innerHTML = '<p>หน้าแรก</p>',
      '/about': () => viewElement.innerHTML = '<p>เกี่ยวกับเรา</p>',
      '/contact': () => viewElement.innerHTML = '<p>ติดต่อเรา</p>'
    };

    function router() {
      const path = window.location.pathname;
      (routes[path] || notFoundHandler)();
    }

    function navigateTo(url) {
      history.pushState(null, null, url);
      router();
    }

    window.addEventListener('popstate', router);

    // Optimize event delegation: check for data-link before processing
    document.addEventListener('click', e => {
      // Early exit if not clicking on or inside a link
      if (!e.target.closest) return;
      const a = e.target.closest('a[data-link]');
      if (a) {
        e.preventDefault();
        // Use getAttribute to avoid URL object creation overhead
        const href = a.getAttribute('href');
        navigateTo(href);
      }
    });

    router();
  </script>
</body>
</html>
